function resetForms(){document.forms["input-form"].reset(),$(".floating-label .custom-select, .floating-label .form-control").floatinglabel()}function checkFirsttime(){"1"==Cookies.get("first-launched")&&($("#launch").remove(),$("#submit-inputs").collapse("show"))}function hideExpnotif(){"1"==Cookies.get("exp-notif-dismiss")&&$("#experimental-notification").remove()}function updateTuning(e){var t="High";100>=$(e).val()&&$(e).val()>=75?t="High ":75>$(e).val()&&$(e).val()>=30?t="Mid ":30>$(e).val()&&$(e).val()>=0&&(t="Low "),$("#lvl-tune-val").val(t+"("+$(e).val()+"%)"),$("#lvl-tune-val-txt").val($(e).val())}function hostSelect(){$("select[name=host-select]").change(function(){"Pichia pastoris"==$(this).val()&&$("#lvl-selection-slider").collapse("hide")})}function ntSlider(){$('input[name="designMode"]').change(function(){$("#primer-button").prop("checked")?$("#primer-length-selection-slider").collapse("show"):$("#primer-length-selection-slider").collapse("hide")})}function updateRange(e){$("#len-primer-val").val("First "+$(e).val()),$("#primer-button").val(+$(e).val()+1)}function showAdvancedForm(){1==$("#advancedSwitch")[0].checked?($("#advancedSwitchText").attr("class","custom-control-label text-danger"),$("#algorithm-settings").collapse("show")):($("#advancedSwitchText").attr("class","custom-control-label text-muted"),$("#algorithm-settings").collapse("hide"))}function termcheckset(){1==$("#termcheck")[0].checked?$("#termcheck-bool").val("True"):$("#termcheck-bool").val("False")}function maketable(e,t){var a,l=$("<tbody />");$.each(t,function(e,t){a=$("<tr />"),$.each(t,function(e,t){a.append("<td>"+t+"</td>")}),a.appendTo(l)}),l.appendTo(e)}$(document).on("click","#show-more",function(){$(this).text(function(e,t){return"Show more"===t?"Hide":"Show more"})}),$(document).on("click","#try-again",function(){$("#input-form").collapse("show"),$("#submit-btn")[0].disabled=!1,$("#show-results").collapse("hide"),$("#show-more").html("Show more"),$("#infinite-prog-bar").collapse("hide"),$("#input-form")[0].reset(),$("#extra-results").collapse("hide"),$("#primer-length-selection-slider").collapse("show"),$("#len-primer").val($("#primer-button").val()-1),$("#len-primer-val").val("First "+$("#len-primer").val()),$("#lvl-tune-val-txt").val(100),$("#lvl-tune").val($("#lvl-tune-val-txt").val()),$("#lvl-tune-val").val($("#lvl-tune-val-txt").val()),$("#lvl-selection-slider").collapse("hide"),$("#advancedSwitchText").attr("class","custom-control-label text-muted"),$("#default-algorithm").attr("class","custom-control custom-radio custom-control-inline"),$("#algo-options-quick").attr("checked",!0),$("#alt-algorithm").attr("class","custom-control custom-radio custom-control-inline"),$("#algo-options-deep").attr("checked",!1),$("#cst-utr").collapse("hide"),$("#algorithm-settings").collapse("hide"),$("#input-form").show()}),$(document).ready(function(){$("#utr").change(function(){var e=$(this).val();"1"==e?($("#cst-utr").collapse("hide"),$("#custom-utr").attr("required",!1),$("#lvl-selection-slider").collapse("show"),$("#lvl-tune-val-txt").val(100)):"3"==e?($("#cst-utr").collapse("show"),$("#custom-utr").attr("required",!0),$("#lvl-selection-slider").collapse("hide")):($("#cst-utr").collapse("hide"),$("#lvl-selection-slider").collapse("hide"),$("#custom-utr").attr("required",!1))})}),$(document).on("click","#demo",function(){$(".floating-label .custom-select, .floating-label .form-control").floatinglabel(),$("#input-sequence").val("ATGAAGAAATCTCTCTCGACCTCTGCTCGCCTCGAGGGAGGACTATCTATCTATCTATCTATCTTCGGCGGACGGACTACCATCGCATTACGGGGCTACGACGGACTCGATCTACTATCTATCTACTTCTAG"),$("#utr").val("1"),$("#lvl-selection-slider").collapse("show"),$("#lvl-tune-val-txt").val("100"),updateTuning("#lvl-tune"),$(".floating-label .custom-select, .floating-label .form-control").floatinglabel(),$("#cst-utr").collapse("hide"),$("#custom-utr").attr("required",!1),$("#nav-input-tab").tab("show")});var defUtr="GGGGAATTGTGAGCGGATAACAATTCCCCTCTAGAAATAATTTTGTTTAACTTTAAGAAGGAGATATACAT",points=[0,.67346939,1.34693878,2.02040816,2.69387755,3.36734694,4.04081633,4.71428571,5.3877551,6.06122449,6.73469388,7.40816327,8.08163265,8.75510204,9.42857143,10.10204082,10.7755102,11.44897959,12.12244898,12.79591837,13.46938776,14.14285714,14.81632653,15.48979592,16.16326531,16.83673469,17.51020408,18.18367347,18.85714286,19.53061224,20.20408163,20.87755102,21.55102041,22.2244898,22.89795918,23.57142857,24.24489796,24.91836735,25.59183673,26.26530612,26.93877551,27.6122449,28.28571429,28.95918367,29.63265306,30.30612245,30.97959184,31.65306122,32.32653061,33],success_openen=[198738964346095e-20,198738964346095e-20,198738964346095e-20,3979134904699868e-20,.0005614693463309397,.0015994783332591886,.007059343154791341,.01959674401987233,.03344511636457853,.05846219766091034,.08812439667470215,.11259352563647178,.1357682202648517,.14211606213908856,.14570074633478247,.1351020183433137,.1268336184495585,.10785947362483832,.09562433135532121,.07934998819340157,.05797529403020855,.04464152892547112,.031056912967964322,.019465426689115016,.013458606780850584,.009290589646287092,.0072191819217718774,.00481998609914608,.003381550290010877,.0027037492134495186,.0018640790321791344,.0010672153576768515,.00030447049761963126,.0001961151937122446,4936898440389916e-20,4358236613730531e-20,.0002030749922550749,.00014137135559688042,.00010345471895537332,437357584524152e-19,11173963588429985e-22,11173963588429985e-22,11173963588429985e-22,11173963588429985e-22,11173963588429985e-22,11173963588429985e-22,11173963588429985e-22,11173963588429985e-22,11173963588429985e-22,11173963588429985e-22],failed_openen=[5437758361148604e-21,5437758361148604e-21,5437758361148604e-21,5397169299206176e-20,.00032248749940829824,.0012660911082912243,.005280751012420593,.009821077717552978,.015469945304867552,.023015782861449723,.033982478828445295,.048250752743149404,.06741365641897708,.07535156640619728,.0834311789634686,.09314100388060208,.10061604385988879,.10365480589977134,.10144817567167914,.09734173335858409,.09274376624962825,.08880318802397255,.08443827862752538,.07766982571253733,.06290949102413919,.051156199195859016,.03966004606891997,.03015605437361742,.023554815332062107,.0191747904887778,.013276183928893279,.00912923396576851,.005819565146953443,.004128214349275207,.0036718639573756536,.0034950737504194852,.002985476454187301,.0018129676325811912,.0012868050108287184,.0009077691932529392,.0005222456180022826,.0002047648974706759,6214594206722606e-20,.00011287484615139223,.00019046772982714063,.00016835234521245699,7676975792930047e-20,1805206870461312e-20,21888850127133413e-22,21888850127133413e-22];function validateinputs(){var e,t=$("#input-sequence").val().replace(/U/gi,"T").replace(/\s+/g,"").toUpperCase(),a=$("#custom-utr").val().replace(/U/gi,"T").toUpperCase();e="3"==$("#utr").val()?a:defUtr;"1"===$("#utr").val()&&$("#host-select").val();var l=/^[ATGCU]*$/,n=["TAG","TGA","TAA"],s=t.match(/.{1,3}/g),r=s[0];s.shift(),s.pop();var o=$("#rms-sites").val().replace(/U/gi,"T").toUpperCase(),i=/^[ACGTU]+(\,{0,1}[AGCTU])+$/;o||(o="TTTTT,CACCTGC,GCAGGTG,GGTCTC,GAGACC,CGTCTC,GAGACG");var c=s.filter(e=>n.includes(e));if(!(0!==c.length||!l.test(t)||!l.test(e)||"ATG"!==r||s.length<25||!i.test(o)||t.length>=3e3||a.length>=300||t.length%3!=0))return event.preventDefault(),$("#input-form").collapse("hide"),$("#submit-btn")[0].disabled=!0,$("#seq-err").collapse("hide"),$("#infinite-prog-bar").collapse("show"),$("#snackbar-msg").attr("class","snackbar snackbar-right show"),$("#new-table0 tbody").remove(),$("#new-table1 tbody").remove(),$("#new-table2 tbody").remove(),"1"==$("select[name=utr]").val()&&"Escherichia coli"==$("select[name=host-select]").val()?$("td:nth-child(3),th:nth-child(3)").show():$("td:nth-child(3),th:nth-child(3)").hide(),1==$("#termcheck")[0].checked?($("td:nth-child(4),th:nth-child(4)").show(),$("td:nth-child(5),th:nth-child(5)").show()):($("td:nth-child(4),th:nth-child(4)").hide(),$("td:nth-child(5),th:nth-child(5)").hide()),!0;$("#seq-err-msg").empty(),$("#seq-err-msg").append("<strong>Sequence error: </strong>"),s.length<25?$("#seq-err-msg").append("The input sequence should be longer than 75 nucleotides."):"ATG"!==r?$("#seq-err-msg").append("The input sequence doesn't have a start codon."):l.test(t)?t.length>=3e3?$("#seq-err-msg").append("The input sequence is too long (>3000 nts). Please use command line version for longer sequence optimisation."):t.length%3!=0?$("#seq-err-msg").append("The input sequence is not divisible by 3."):"3"==$("#utr").val()&&e.length<71?$("#seq-err-msg").append("The input 5&#8242; UTR sequence should be longer than 71 nucleotides."):l.test(e)?0!==c.length?$("#seq-err-msg").append("The input sequence has an early stop codon."):i.test(o)?0==len(e)||l.test(e)||$("#seq-err-msg").append("Only A, T, G, C, U are allowed in the input 5&#8242; UTR sequence."):$("#seq-err-msg").append("The input restriction sites are not in a proper format. Please use comma to separate multiple sites. Only A, T, G, C, U are allowed."):$("#seq-err-msg").append("Only A, T, G, C, U are allowed in the input 5&#8242; UTR sequence."):$("#seq-err-msg").append("Only A, T, G, C, U are allowed in the input sequence."),$("#seq-err").collapse("show"),event.preventDefault()}function plotaccs(e,t){window.chartColors={red:"rgb(255, 99, 132)",orange:"rgb(255, 159, 64)",yellow:"rgb(255, 205, 86)",green:"rgb(75, 192, 192)",blue:"rgb(54, 162, 235)",purple:"rgb(153, 102, 255)",grey:"rgb(231,233,237)"};var a=[],l=[];$.each(t.Selected,function(e,t){a.push(t.Accessibility)}),$.each(t.Input,function(e,t){l.push(t.Accessibility)}),window.chart&&null!==window.chart&&window.chart.destroy(),1==("1"===$("#utr").val()&&"Escherichia coli"===$("#host-select").val()?1:0)&&(window.chart=new Chart(e,{type:"line",data:{labels:points,datasets:[{label:"Success",backgroundColor:window.chartColors.blue,borderColor:window.chartColors.blue,fill:!1,data:success_openen,yAxisID:"probDensity",pointRadius:1,pointHoverRadius:1,linetension:1.5},{label:"Failed",backgroundColor:window.chartColors.orange,borderColor:window.chartColors.orange,fill:!1,data:failed_openen,yAxisID:"probDensity",pointRadius:1,pointHoverRadius:1,linetension:1.5}]},options:{title:{display:!0,position:"bottom",text:"Distributions for PSI:Biology targets (8,780 ‘success’ and 2,650 ‘failure’ experiments)."},tooltips:{enabled:!0,mode:"index",callbacks:{label:function(e,t){return" Fraction of data with this opening energy: : "+e.yLabel}}},animation:{easing:"easeInOutBack"},scales:{yAxes:[{id:"probDensity",type:"linear",ticks:{},scaleLabel:{display:!0,labelString:""}}],xAxes:[{beginAtZero:!0,type:"category",position:"bottom",display:!1},{id:"x-axis-2",type:"linear",position:"bottom",display:!0,scaleLabel:{display:!0,labelString:"Opening Energy"},ticks:{min:0,max:33,stepSize:.25}}]},annotation:{annotations:[{type:"line",drawTime:"afterDatasetsDraw",mode:"vertical",scaleID:"x-axis-2",value:a,borderColor:"rgb(75, 192, 192)",borderWidth:2,label:{enabled:!0,content:"Optimised",position:"top"}},{type:"line",drawTime:"afterDatasetsDraw",mode:"vertical",scaleID:"x-axis-2",value:l,borderColor:"rgb(75, 192, 192)",borderWidth:2,label:{enabled:!0,content:"Input",position:"center"}}]}}}))}function successfunc(e){maketable("#new-table0",e.Selected),maketable("#new-table1",e.Input),maketable("#new-table2",e.Optimised),plotaccs(document.getElementById("myChart").getContext("2d"),e),$("#infinite-prog-bar").collapse("hide"),$("#snackbar-msg").attr("class","snackbar snackbar-right hide"),$(frm).hide(),$("#show-results").collapse("show")}function errorfunc(e,t,a){var l=e.responseText;$("#infinite-prog-bar").hide(),$("#snackbar-msg").attr("class","snackbar snackbar-right hide"),$(frm).hide(),500==e.status?$("#input-form-card").append(`<div class='card-body'><h5 class='card-title'>Error ${e.status}:</h5><p class='card-text'>There was some error in the application. Please review the suggestion below before refreshing the page and try again.</p><h6 class='card-subtitle mb-2 text-muted'>${l}</h6><div class='container''><canvas id='errorCanvas' style=';width:100%;height:100%'></canvas></div></div>`):400==e.status?$("#input-form-card").append(`<div class='card-body'><h5 class='card-title'>Error ${e.status}:</h5><p class='card-text'>There was some error in the application. Please refresh the page and try again.</p><h6 class='card-subtitle mb-2 text-muted'>${l}</h6><div class='container'><canvas id='errorCanvas' style=';width:100%;height:100%'></canvas></div></div>`):$("#input-form-card").append(`<div class='card-body'><h5 class='card-title'>Error ${e.status}</h5><h6 class='card-subtitle mb-2 text-muted'>${l}</h6><p class='card-text'>Please refresh the page and try again.</p><div class='container'><canvas id='errorCanvas' style=';width:100%;height:100%'></canvas></div></div>`);var n=errorCanvas.getContext("2d",{alpha:!1});n.fillStyle="#000";var s=n.createImageData(errorCanvas.width,errorCanvas.height),r=new Uint32Array(s.data.buffer);!function e(){!function(e){var t=r.length-1;for(;t--;)r[t]=Math.random()<.5?0:-1;e.putImageData(s,0,0)}(n),requestAnimationFrame(e)}()}
